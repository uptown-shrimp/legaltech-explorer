<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Legal‑Tech Explorer — 50‑Tool Demo (Schema Filters)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1220; --panel:#0e1526; --card:#0f1a33; --border:rgba(255,255,255,.12);
    --muted:#97a3b6; --text:#e8f0ff; --accent:#7aa2f7; --card2:#0b172f;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#0a0f1c);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;display:flex;gap:10px;align-items:center;padding:10px 14px;background:rgba(5,8,14,.7);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  header h1{margin:0;font-size:16px;font-weight:700}
  .sub{color:var(--muted);font-size:12px}
  .wrap{display:grid;grid-template-columns:320px 1fr 420px;gap:12px;padding:12px;min-height:calc(100vh - 52px)}
  aside.left,aside.right{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:12px;min-height:0}
  main{min-height:0;display:flex;flex-direction:column;gap:12px}
  .box{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px}
  .filters .group{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:8px;margin:8px 0}
  .filters .group>summary{cursor:pointer;list-style:none;color:var(--text);font-weight:700}
  .filter-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .filter-field{display:flex;flex-direction:column;gap:6px;margin:8px 0}
  .filter-field label{font-size:12px;color:var(--muted)}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:rgba(255,255,255,.06);border:1px solid var(--border);border-radius:999px;cursor:pointer}
  .chip input{accent-color:var(--accent)}
  input[type="search"],input[type="number"],select{width:100%;padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:#0b1428;color:var(--text)}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .tools{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  .tool{border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card2);display:flex;flex-direction:column;gap:6px}
  .title{font-weight:700;font-size:14px}
  .meta{color:var(--muted);font-size:12px}
  .desc{color:#dfe7ff;font-size:12px}
  .actions{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:6px}
  .btn{padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer}
  .btn:hover{border-color:rgba(255,255,255,.24)}
  .stars{display:inline-flex;gap:2px;cursor:pointer;font-size:14px}
  .star{opacity:.6}.star.on{opacity:1}
  .col-title{font-weight:800;letter-spacing:.3px;text-transform:uppercase;font-size:11px;color:var(--muted);margin:2px 0 8px}
  .left{position:sticky;top:54px;align-self:start}
  .right{position:sticky;top:54px;align-self:start}
</style>
</head>
<body>
  <header>
    <h1>Legal‑Tech Explorer</h1>
    <div class="sub">Left: Filters • Middle: Results • Right: Details & Compare — all client‑side</div>
  </header>

  <div class="wrap">
    <aside class="left">
      <div class="box filters">
        <div style="font-weight:800;margin-bottom:4px">Filters</div>
        <div class="sub" style="margin-bottom:6px">Schema‑driven facets</div>
        <!-- dynamic filters will be injected here -->
      </div>
    </aside>

    <main>
      <div class="box">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div class="col-title">Results</div><div class="sub" id="count"></div></div>
        <div id="tools" class="tools"></div>
      </div>
    </main>

    <aside class="right">
      <div class="box">
        <div class="col-title">Details</div>
        <div id="details">Select a tool to see full info.</div>
      </div>
      <div class="box">
        <div class="col-title">Comparison (up to 5)</div>
        <div id="compareList" class="filter-row"></div>
        <div style="height:8px"></div>
        <div style="max-height:360px;overflow:auto"><table class="compare" id="compareTable"></table></div>
      </div>
    </aside>
  </div>

<script>
  // ===== Schema (fields, groups, and types) =====
  var SCHEMA = [
    { key: 'Vendor Name', group: 'Vendor Identification', type: 'text' },
    { key: 'Vendor Overview', group: 'Vendor Identification', type: 'text' },
    { key: 'HQ', group: 'Vendor Identification', type: 'single' },
    { key: 'Office Locations', group: 'Vendor Identification', type: 'text' },
    { key: 'Regions Served', group: 'Vendor Identification', type: 'multi', values: ['Australia','New Zealand','Asia-Pacific (APAC)','North America (US & Canada)','Europe (UK & EU)','United Kingdom','Middle East','Africa','Latin America','Unknown'] },
    { key: 'Year Founded', group: 'Vendor Identification', type: 'number-range' },

    { key: 'Product Name', group: 'Product Identification', type: 'text' },
    { key: 'Product Description', group: 'Product Identification', type: 'text' },
    { key: 'Languages supported', group: 'Product Identification', type: 'single', values: ['English only','English + Limited Other Languages','Multilingual (supports major global languages)','Unknown / To Verify'] },

    { key: 'Legal Functionality – Main Category', group: 'Legal Functionality & Use Case', type: 'single', values: ['Contracting & Document Automation','Matter, Workflow & Intake Management','Legal Operations & Analytics','Outside Counsel & Spend Management','Compliance, Risk & Governance','Corporate Governance & Entity Management','Litigation, Disputes & Investigations','Intellectual Property, Technology & Data','Employment & HR Legal Support','Cross-Border, Transactions & Deal Management','Knowledge, Search & Precedent Management','AI Legal Assistants & Productivity Tools','Business Partnering & Self-Service Tools','Integration & Platform Infrastructure','Legal Research & Insights.'] },
    { key: 'Legal Functionality – Sub-Category', group: 'Legal Functionality & Use Case', type: 'single' },
    { key: 'Main Problem Solved', group: 'Legal Functionality & Use Case', type: 'text' },

    { key: 'Primary User Segment', group: 'Audience, Fit & Accessibility', type: 'multi', values: ['Corporate legal','Private practice','Alternative Legal Service Providers (ALSPs)','Legal Operations Professionals','Contract Management Teams / Procurement','Compliance & Risk Teams','Litigation / Disputes Teams','Intellectual Property Teams.'] },
    { key: 'Industry Focus', group: 'Audience, Fit & Accessibility', type: 'single', values: ['Corporate','Government / Public Sector','Financial Services','Healthcare / Life Sciences','Education / Research','Energy / Resources','Professional Services','Other / Not Specified'] },

    { key: 'AI Maturity Stage', group: 'AI Capabilities & Innovation', type: 'single', values: ['Experimental / early stage','Quick win','Advanced','Enterprise-grade'] },
    { key: 'AI Powered', group: 'AI Capabilities & Innovation', type: 'single', values: ['Yes','No'] },
    { key: 'AI Platform', group: 'AI Capabilities & Innovation', type: 'multi', values: ['Large Language Model (LLM) Platforms','Predictive / Machine Learning (ML) Platforms','Natural Language Processing (NLP) / Text Analytics','Computer Vision & Document Recognition','Recommendation & Decision Support Systems','Conversational / Copilot Layer','AI Integration / Orchestration Layer','Domain-Specific or Proprietary AI Engines.'] },
    { key: 'Deployment Model', group: 'AI Capabilities & Innovation', type: 'single', values: ['Cloud (SaaS)','Private Cloud','On-Premises','Hybrid','Desktop / Local Application.'] },
    { key: 'Hosting Location / Data Residence', group: 'AI Capabilities & Innovation', type: 'single', values: ['Australia','Asia-Pacific (ex-AU)','United States','Europe / UK','Multi-Region / Distributed Cloud','Customer-Hosted / Private Cloud','Unknown / To Verify'] },
    { key: 'Hosting Provider', group: 'AI Capabilities & Innovation', type: 'single', values: ['AWS','Azure','Google Cloud','Other'] },

    { key: 'ISO Certifications', group: 'Security, Privacy & Trust', type: 'multi', values: ['ISO 27001','ISO 27017','ISO 27018','ISO 27701','ISO 22301','ISO 9001','ISO 20000'] },
    { key: 'Security & Compliance Certifications', group: 'Security, Privacy & Trust', type: 'multi', values: ['SOC 1 (Type I or II)','SOC 2 (Type I or II)','SOC 3','GDPR Compliance (EU)','CCPA Compliance (US)','HIPAA Compliance (US)','FedRAMP, Authorization (US)','IRAP Assessment (AU)','CSA STAR Certification','Cyber Essentials / Plus (UK).'] },

    { key: 'Pricing Model', group: 'Commercials & Procurement', type: 'single', values: ['Subscription (SaaS)','Usage-Based / Consumption','Per Seat / License','Tiered / Plan-Based','Enterprise Custom Quote','Freemium / Free Trial','One-Time Purchase / Perpetual License.'] },
    { key: 'Approx. Price Range (AUD)', group: 'Commercials & Procurement', type: 'single', values: ['<$10K','$10K–$50K','$51K-$100K','$101K+'] },
    { key: 'Demo / Proof of Concept Available', group: 'Commercials & Procurement', type: 'single', values: ['Yes','No','Unknown'] },
    { key: 'Adoption Level', group: 'Commercials & Procurement', type: 'single', values: ['Emerging / New Entrant','Growing Adoption','Mainstream / Proven','Market Leader / Standard','Unknown / To Verify'] },
    { key: 'Ease of Purchase', group: 'Commercials & Procurement', type: 'single', values: ['Very Easy','Easy','Moderate','Complex'] },

    { key: 'Customer Reviews', group: 'Customer Reviews', type: 'text' },
    { key: 'Customer Feedback Rating', group: 'Customer Reviews', type: 'number-range' },

    { key: 'Vendor Contact Details', group: 'Vendor Identification', type: 'text' },
    { key: 'Vendor Website', group: 'Vendor Identification', type: 'text' }
  ];

  // Minimal demo data (replace with your full 50 rows inline or use a loader variant)
  var DATA = [{
    "__id":"actionstep-actionstep-https-www-actionstep-com-0",
    "__display_name":"Actionstep — Actionstep",
    "Vendor Name":"Actionstep",
    "Vendor Overview":"Actionstep is a modern, adaptable law firm management platform designed to streamline legal operations and improve client service.",
    "HQ":"New Zealand",
    "Regions Served":"Asia-Pacific (APAC); North America (US & Canada); Europe (UK & EU); Latin America",
    "Year Founded":"2004",
    "Product Name":"Actionstep",
    "Product Description":"Comprehensive practice management with workflows, matter management, document automation, and billing.",
    "Languages supported":"English only",
    "Legal Functionality – Main Category":"Matter, Workflow & Intake Management",
    "Legal Functionality – Sub-Category":"Workflow Automation",
    "Primary User Segment":"Corporate legal; Legal Operations Professionals",
    "AI Maturity Stage":"Enterprise-grade",
    "AI Powered":"Yes",
    "AI Platform":"Large Language Model (LLM) Platforms; AI Integration / Orchestration Layer",
    "Deployment Model":"Cloud (SaaS)",
    "Hosting Location / Data Residence":"Multi-Region / Distributed Cloud",
    "Hosting Provider":"AWS",
    "ISO Certifications":"ISO 27001",
    "Security & Compliance Certifications":"SOC 2 (Type I or II); GDPR Compliance (EU)",
    "Pricing Model":"Subscription (SaaS)",
    "Approx. Price Range (AUD)":"$10K–$50K",
    "Demo / Proof of Concept Available":"Yes",
    "Adoption Level":"Mainstream / Proven",
    "Ease of Purchase":"Moderate",
    "Customer Reviews":"Well regarded by midsize firms",
    "Customer Feedback Rating":"4.3",
    "Vendor Contact Details":"https://www.actionstep.com/contact/",
    "Vendor Website":"https://www.actionstep.com/"
  }];

  // ----- Helpers -----
  function esc(s){ return (s||'').toString().replace(/[&<>"]/g,function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m];}); }
  function splitMulti(v){ if(!v) return []; return String(v).split(/[;,|\/\n]+/).map(function(x){return x.trim();}).filter(Boolean); }

  var filtersBox = document.querySelector('.filters');
  var toolsEl = document.getElementById('tools');
  var detailsEl = document.getElementById('details');
  var countEl = document.getElementById('count');

  // Build quick search
  var quick = document.createElement('div');
  quick.className = 'filter-field';
  quick.innerHTML = '<label>Quick Search</label><input id="q" type="search" placeholder="Search tool, vendor, description…">';
  filtersBox.appendChild(quick);
  var q = document.getElementById('q');

  // Map of controls: key -> {type, get()}
  var CONTROLS = new Map();

  function groupContainer(title){
    var d = document.createElement('details'); d.className='group'; d.open=true;
    d.innerHTML = '<summary>'+esc(title)+'</summary>';
    filtersBox.appendChild(d); return d;
  }

  function uniqueValues(key){
    var cfg = SCHEMA.find(function(s){return s.key===key;});
    if(cfg && cfg.values) return cfg.values;
    var vals = {};
    DATA.forEach(function(r){
      var arr = splitMulti(r[key]);
      if(arr.length){ arr.forEach(function(v){ vals[v]=1; }); }
      else if(r[key]){ vals[String(r[key])] = 1; }
    });
    return Object.keys(vals).sort();
  }

  function addTextControl(parent, key, placeholder){
    var wrap = document.createElement('div'); wrap.className='filter-field';
    wrap.innerHTML = '<label>'+esc(key)+'</label><input data-key="'+esc(key)+'" type="search" placeholder="'+esc(placeholder||'Search…')+'">';
    parent.appendChild(wrap);
    var el = wrap.querySelector('input');
    CONTROLS.set(key, { type:'text', get:function(){ return el.value.trim(); } });
  }

  function addSingleSelect(parent, key, options){
    var wrap = document.createElement('div'); wrap.className='filter-field';
    var html = '<label>'+esc(key)+'</label><select data-key="'+esc(key)+'"><option value="">Any</option>';
    options.forEach(function(v){ html += '<option>'+esc(v)+'</option>'; });
    html += '</select>';
    wrap.innerHTML = html; parent.appendChild(wrap);
    var sel = wrap.querySelector('select');
    CONTROLS.set(key, { type:'single', get:function(){ return sel.value; } });
  }

  function addMultiChips(parent, key, options){
    var wrap = document.createElement('div'); wrap.className='filter-field';
    wrap.innerHTML = '<label>'+esc(key)+'</label><div class="filter-row"></div>';
    parent.appendChild(wrap);
    var row = wrap.querySelector('.filter-row');
    options.forEach(function(v){
      var lab = document.createElement('label'); lab.className='chip';
      lab.innerHTML = '<input type="checkbox" value="'+esc(v)+'"> <span>'+esc(v)+'</span>';
      row.appendChild(lab);
    });
    CONTROLS.set(key, { type:'multi', get:function(){ return Array.prototype.map.call(row.querySelectorAll('input:checked'), function(c){return c.value;}); } });
  }

  function addNumberRange(parent, key){
    var wrap = document.createElement('div'); wrap.className='filter-field';
    wrap.innerHTML = '<label>'+esc(key)+'</label><div class="two"><input type="number" placeholder="Min" class="min"><input type="number" placeholder="Max" class="max"></div>';
    parent.appendChild(wrap);
    var minEl = wrap.querySelector('.min'); var maxEl = wrap.querySelector('.max');
    CONTROLS.set(key, { type:'number-range', get:function(){ return {min:minEl.value, max:maxEl.value}; } });
  }

  // Build groups and fields
  var groups = [];
  SCHEMA.forEach(function(s){ if(groups.indexOf(s.group)===-1) groups.push(s.group); });
  groups.forEach(function(grp){
    var sec = groupContainer(grp);
    var inner = document.createElement('div'); sec.appendChild(inner);
    SCHEMA.filter(function(s){return s.group===grp;}).forEach(function(field){
      var opts = uniqueValues(field.key);
      if(field.type==='text') addTextControl(inner, field.key);
      else if(field.type==='single') addSingleSelect(inner, field.key, opts);
      else if(field.type==='multi') addMultiChips(inner, field.key, opts);
      else if(field.type==='number-range') addNumberRange(inner, field.key);
    });
  });

  // Options row (dedupe)
  var dedupeRow = document.createElement('div'); dedupeRow.className='filter-field';
  dedupeRow.innerHTML = '<label>Options</label><label style="font-size:12px;color:var(--muted)"><input id="dedupeVendor" type="checkbox" checked> Deduplicate identical rows</label>';
  filtersBox.appendChild(dedupeRow);
  var dedupeVendor = document.getElementById('dedupeVendor');

  // ----- Filtering -----
  function quickBlob(rec){
    return (rec.__display_name+' '+(rec['Vendor Name']||'')+' '+(rec['Product Name']||'')+' '+(rec['Product Description']||'')+' '+(rec['Vendor Overview']||''));
  }
  function numberInRange(rec, key, range){
    if(!range || (!range.min && !range.max)) return true;
    var n = parseFloat(rec[key]); if(isNaN(n)) return false;
    if(range.min && n < parseFloat(range.min)) return false;
    if(range.max && n > parseFloat(range.max)) return false;
    return true;
  }
  function multiMatch(recVal, selected){
    if(!selected || !selected.length) return true;
    var hay = splitMulti(recVal);
    var set = {};
    hay.forEach(function(v){ set[v]=1; });
    for(var i=0;i<selected.length;i++){ if(set[selected[i]]) return true; }
    return false;
  }
  function matchRecord(rec){
    var t = q.value.trim().toLowerCase();
    if(t){ if(quickBlob(rec).toLowerCase().indexOf(t)===-1) return false; }
    for(var i=0;i<SCHEMA.length;i++){
      var cfg = SCHEMA[i]; var ctl = CONTROLS.get(cfg.key); if(!ctl) continue; var val = ctl.get();
      if(!val || (Array.isArray(val)&&!val.length)) continue;
      if(cfg.type==='text'){ if(String(rec[cfg.key]||'').toLowerCase().indexOf(String(val).toLowerCase())===-1) return false; }
      else if(cfg.type==='single'){ if(String(rec[cfg.key]||'')!==String(val)) return false; }
      else if(cfg.type==='multi'){ if(!multiMatch(rec[cfg.key], val)) return false; }
      else if(cfg.type==='number-range'){ if(!numberInRange(rec, cfg.key, val)) return false; }
    }
    return true;
  }
  function keyByVendorTool(rows){
    var seen={}, out=[]; rows.forEach(function(r){ var k=(r['Vendor Name']||'')+'|'+(r['Product Name']||'')+'|'+(r['Vendor Website']||''); if(!seen[k]){ seen[k]=1; out.push(r);} }); return out;
  }

  // ----- Render -----
  var compare = [];
  function getRating(id){ var v=localStorage.getItem('rate:'+id); return v?parseInt(v,10):0; }
  function setRating(id,v){ localStorage.setItem('rate:'+id, String(v)); }
  function toggleCompare(id){ var i=compare.indexOf(id); if(i===-1){ if(compare.length>=5) return; compare.push(id);} else compare.splice(i,1); renderCompare(); }

  function renderStars(id){ var r=getRating(id), html=''; for(var i=1;i<=5;i++){ html+='<span class="star '+(i<=r?'on':'')+'" data-i="'+i+'">★</span>'; } return '<div class="stars" data-id="'+id+'">'+html+'</div>'; }

  function renderList(rows){
    countEl.textContent = rows.length + ' tools';
    toolsEl.innerHTML = '';
    rows.slice(0,200).forEach(function(rec){
      var url = rec['Vendor Website'] || '';
      var chosen = compare.indexOf(rec.__id)!==-1;
      var cats = splitMulti(rec['Legal Functionality – Main Category']).concat(splitMulti(rec['Legal Functionality – Sub-Category']));
      var chips = cats.map(function(c){ return '<span class="chip" style="padding:2px 6px;font-size:11px">'+esc(c)+'</span>'; }).join(' ');
      var card = document.createElement('div'); card.className='tool'; card.dataset.id = rec.__id;
      var html = ''+
        '<div class="title">'+esc(rec.__display_name||rec['Product Name']||rec['Vendor Name']||'Unnamed')+'</div>'+
        '<div class="meta">'+esc(rec['Vendor Name']||'')+' • <span>'+esc(rec['HQ']||'')+'</span> '+(url?('• <a href="'+esc(url)+'" target="_blank" rel="noopener">Open ↗</a>'):'')+'</div>'+
        '<div class="desc">'+esc(rec['Product Description']||'')+'</div>'+
        '<div class="filter-row">'+chips+'</div>'+
        '<div class="actions">'+
          '<div>'+renderStars(rec.__id)+'</div>'+
          '<div>'+
            '<button class="btn btn-details">Details</button> '+
            '<button class="btn btn-compare">'+(chosen?'Remove from compare':'Add to compare')+'</button>'+
          '</div>'+
        '</div>';
      card.innerHTML = html; toolsEl.appendChild(card);
    });

    Array.prototype.forEach.call(toolsEl.querySelectorAll('.stars'), function(st){
      var id = st.getAttribute('data-id');
      st.addEventListener('click', function(e){ var s=e.target.closest('.star'); if(!s) return; setRating(id, parseInt(s.getAttribute('data-i'),10)); applyFilters(); });
    });
    Array.prototype.forEach.call(toolsEl.querySelectorAll('.btn-details'), function(btn){
      btn.addEventListener('click', function(e){ var id=e.target.closest('.tool').dataset.id; var rec=DATA.find(function(r){return r.__id===id;}); renderDetails(rec); });
    });
    Array.prototype.forEach.call(toolsEl.querySelectorAll('.btn-compare'), function(btn){
      btn.addEventListener('click', function(e){ var id=e.target.closest('.tool').dataset.id; toggleCompare(id); applyFilters(); });
    });
  }

  function renderDetails(rec){
    if(!rec){ detailsEl.textContent='No record'; return; }
    var rows='';
    Object.keys(rec).forEach(function(k){
      if(/^_/.test(k) || /^__/.test(k)) return;
      var v = rec[k]; if(v==null || v==='') return;
      var val = esc(v);
      if(/^https?:\/\//i.test(String(v))) val = '<a href="'+v+'" target="_blank" rel="noopener">'+esc(v)+'</a>';
      rows += '<tr><th>'+esc(k)+'</th><td>'+val+'</td></tr>';
    });
    detailsEl.innerHTML = '<table class="compare">'+rows+'</table>';
  }

  function renderCompare(){
    var list=document.getElementById('compareList'); var tbl=document.getElementById('compareTable');
    list.innerHTML=''; if(!compare.length){ tbl.innerHTML='<tr><td style="color:var(--muted)">Nothing selected</td></tr>'; return; }
    compare.forEach(function(id){ var rec=DATA.find(function(r){return r.__id===id;}); var pill=document.createElement('div'); pill.className='chip'; pill.innerHTML='<span>'+esc(rec.__display_name)+'</span> <span class="x" data-id="'+id+'">✕</span>'; list.appendChild(pill); });
    Array.prototype.forEach.call(list.querySelectorAll('.x'), function(x){ x.addEventListener('click', function(e){ var id=e.target.getAttribute('data-id'); var i=compare.indexOf(id); if(i!==-1){ compare.splice(i,1); renderCompare(); } }); });

    var cols = SCHEMA.map(function(s){return s.key;}).slice(0,24);
    var header = '<tr><th>Field</th>' + compare.map(function(id){ var rec=DATA.find(function(r){return r.__id===id;}); return '<th>'+esc(rec.__display_name)+'</th>'; }).join('') + '</tr>';
    var html = header;
    cols.forEach(function(col){
      html += '<tr><th>'+esc(col)+'</th>';
      compare.forEach(function(id){ var rec=DATA.find(function(r){return r.__id===id;}); var val = rec[col] || ''; if(/^https?:\/\//i.test(String(val))) val = '<a href="'+val+'" target="_blank" rel="noopener">Open ↗</a>'; html += '<td>'+ (val? esc(String(val)).replace(/(https?:\/\/\S+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>') : '') + '</td>'; });
      html += '</tr>';
    });
    tbl.innerHTML = html;
  }

  function applyFilters(){
    var rows = DATA.filter(matchRecord);
    if(document.getElementById('dedupeVendor').checked) rows = keyByVendorTool(rows);
    renderList(rows);
    renderCompare();
  }

  filtersBox.addEventListener('input', applyFilters);
  applyFilters();
</script>
</body>
</html>